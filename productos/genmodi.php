<? //Modificacion buena//Parte de variables****************************************************$ano = $_POST["ano"];$temp = $_POST["temp"];$familia = $_POST["familia"];$talla = $_POST["talla"];$color = $_POST["color"];$proveedor = $_POST["proveedor"];$rproveedor = $_POST["rproveedor"];$descripcion = $_POST["descripcion"];$precioc = $_POST["precioc"];$preciov = $_POST["preciov"];$stock = $_POST["stock"];$referencia = $_POST["referencia"];$refi = $_POST["refi"];//echo "-->".$refi .",". $ano .",". $temp .",". $familia .",". $talla .",". $color .",". $proveedor .",". $rproveedor .",". $descripcion .",". $precioc .",". $preciov .",". $stock .",". $referencia;/**************************************************************************************************************///Generacion referencia//Se genera la referencia que se almacenara con año(2), temp(2), familia(2), talla(2), color(3), proveedor(2), correlativo(3)//En el caso de modificaciones, si no se modifica nada de lo que genera la referencia la referencia es la misma//como sabemos si se ha modificado algo, consultamos a la base de datos por $refi a ver que dice sobre los campos/****************************************************************//*el error esta aqui, ya que $refi no vale nada*/$comprobacion = "select * from productos where id like $refi";//echo $comprobacion;/*error, $refi no vale nada*//***************************************************************/$rcomprobacion = mysql_db_query($dbname, $comprobacion, $con);$celdacom = mysql_fetch_array($rcomprobacion);if ((($ano) == ($celdacom[ano])) && (($temp) == ($celdacom[temporada])) && (($familia) == ($celdacom[familia])) && (($talla) == ($celdacom[talla])) && (($color) == ($celdacom[color])) && (($proveedor) == ($celdacom[proveedor]))){//echo "No cambia";$correlat = $celdacom[correlativo];}//Si se modifica algo de lo que genera la referencia esta cambia,//Si se ha borrado algun producto cojera la referencia de los borradoselse{//echo "Cambia";$compo = "select * from productos where ano like $ano and temporada like $temp and familia like $familia and talla like $talla and proveedor like $proveedor and color like $color";//echo $compo;$rcompo = mysql_db_query ($dbname, $compo, $con);$correlat=1;	while($celda = mysql_fetch_array($rcompo))	{	if ($rcompo[correlativo] == $correlat)	$correlat++;	}}	//if($celda[correlativo]==$correlat-1)	//$correlat = $celda[correlativo];/****************/	if ($familia <= 9)	{	$nufam = "0". $familia;	}	else	{	$nufam = $familia;	}/****************/	if ($talla <= 9)	{	$nutall = "0". $talla;	}	else	{	$nutall = $talla;	}/****************/	if ($color <= 9)	{	$nucol = "0". $color;	}	else 	//{		//if ($color <= 99)		//{		//$nucol = "0". $color;		//}		//else		$nucol = $color; 	//}/****************/	if ($proveedor <= 9)	$nupro = "0". $proveedor;	else	$nupro = $proveedor;/****************Parte del numero correlativo quito las opciones del 0 delante para dejar uno solo*******/	//if ($correlat <= 9)	//$nucorrelat = "00". $correlat;	//else {	//if ($correlat <= 99)	//$nucorrelat = "0". $correlat;//	else	$nucorrelat = $correlat; //}/****************/
include("gencode13.php");//echo $ean13;
//$nurefe= $ano ."". $temp ."". $nufam ."". $nutall ."". $nucol ."". $nupro ."". $nucorrelat;$nurefe = $ean13;
//Si la referencia generada es la misma no se cambia.if ($nurefe == $referencia)$nurefe = $referencia;//echo "<p>La referencia generada es ". $nurefe;//echo "<p>La referencia anterior es ". $referencia;///Finalizacion de la generacion de la referencia/**************************************************************************************************************///en la modificacion hay que comprobar que si la referencia en la modificacion .?no se ha cambiado no se modifiqueif (isset($_POST['mproducto']))	{	$modif = "update productos set ano ='$ano', temporada = '$temp', referencia = '$ean13', familia = '$familia', color = '$color', proveedor = '$proveedor', referenciap ='$rproveedor', descripcion = '$descripcion', precioc = '$precioc', preciov ='$preciov', stock = '$stock', ean13='$ean13' where id like '$refi'";		if($rmodif = mysql_db_query($dbname, $modif, $con))		echo "Consulta completada con exito";		else		echo "No se ha realizado la consulta";	}if (isset($_POST['bproducto']))	{	$borrado = "delete from productos where id like $refi";	if($rborrado = mysql_db_query($dbname, $borrado, $con))		echo "Consulta completada con exito";		else		echo "No se ha realizado la consulta";	}?>