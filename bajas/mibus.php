<?//Fichero mibus.php$ano = $_POST['ano'];$temp = $_POST['temp'];$fami = $_POST['familia'];$talla = $_POST['talla'];$color = $_POST['color'];$proveedor = $_POST['proveedor'];$precios = $_POST['precios'];$libre = $_POST['libre'];$param=0;//echo "tengo". $ano .",". $temp .",". $fami .",". $talla .",". $color .",". $proveedor .",". $precios .",". $libre;//hay que tener en cuenta que se quiere buscar y que no, lo sabemos por que si no esta marcado es 0 o nulo en el caso//del libre, if ($ano != 0){$cadena[0] = "ano = '$ano'";$param++;$chiv=0;}if ($temp != '0'){$cadena[1] = "temporada = '$temp'";$param++;$chiv=1;}if ($fami != '0'){$cadena[2] = "familia like '$fami'";$param++;$chiv=2;}if ($talla != '0'){$cadena[3] = "talla like '$talla'";$param++;$chiv=3;}if ($color != '0'){$cadena[4] = "color like '$color'";$param++;$chiv=4;}if ($proveedor != '0'){$cadena[5] = "proveedor like '$proveedor'";$param++;$chiv=5;}// -10, 10-30, 30-50, 50-100, 100-200, +200if ($precios != '0'){	switch ($precios)	{	case '1': $cadena[6] = " preciov < 10";break;	case '2': $cadena[6] = " preciov >= 10 and preciov < 30";break;	case '3': $cadena[6] = " preciov >= 30 and preciov < 50";break;	case '4': $cadena[6] = " preciov >= 50 and preciov < 100";break;	case '5': $cadena[6] = " preciov >= 100 and preciov < 200";break;	case '6': $cadena[6] = " preciov >= 200";break;	}$param++;$chiv=6;}if ($libre != NULL){$cadena[7] = " referenciap like '%$libre%' or referencia like '%$libre%' or descripcion like '%$libre%'";$param++;$chiv=7;}if ($param != 0){	$consulta = "Select * from productos where ";	if ($param == 1)	{	$consulta .= $cadena[$chiv];	}	else	{			$primer=0;			for ($i=0;$i<=7;$i++)			{								if(isset($cadena[$i]))				//if ($cadena[$i] != NULL)				{										if($primer == 0)					{										$consulta .= $cadena[$i];					}					else					{					$consulta .= " and ";						$consulta .= $cadena[$i];					}					$primer=1;				}			}	}}if (isset($_POST['bprod'])){if (isset($consulta)){	$resultado = mysql_db_query($dbname, $consulta, $con);		print("<table><tr $_SESSION[colorc]><th>Referencia</th><th>Referencia Proveedor</th><th>Proveedor</th><th>Año</th><th>Temporada</th><th>Familia</th><th>Descripcion</th><th>Talla<th>Color</th><th>Stock</th><th>PCP</th><th>PVP</th></tr>");		while ($celda = mysql_fetch_array($resultado))		{		$cont++;		if ($cont % 2 == 0)		$color = $_SESSION[color2];		else		$color = $_SESSION[color1];		//Referencia		print("<tr $color><td><a href=index.php?id=1&amp;baja=1&amp;ref=$celda[id]>$celda[referencia]</a>");		//Referencia proveedor		print("<td>$celda[referenciap]");		//Proveedor		$bproveedor ="select p.id, p.proveedor, s.id, s.nombre from productos as p ,proveedores as s where s.id = $celda[proveedor]";		$rbproveedor = mysql_db_query($dbname, $bproveedor, $con);		$celdap = mysql_fetch_array($rbproveedor);		print("<td>$celdap[nombre]</td>");		//Año		print("<td>$celda[ano]");		//Temporada		print("<td>$celda[temporada]");		//Familia		$bfam = "select p.id, p.talla, s.id, s.nombre from productos as p ,familias as s where s.id = $celda[familia]";		$rbfam = mysql_db_query($dbname, $bfam, $con);		$celdaf = mysql_fetch_array($rbfam);		print("<td>$celdaf[nombre]</td>");		//Descripcion		print("<td>$celda[descripcion]</td>");		//Talla		$btalla = "select p.id, p.talla, s.id, s.nombre from productos as p ,tallas as s where s.id = $celda[talla]";		$rbtalla = mysql_db_query($dbname, $btalla, $con);		$celdat = mysql_fetch_array($rbtalla);		print("<td>$celdat[nombre]</td>");		//Color		$bcolor = "select p.id, p.talla, s.id, s.nombre from productos as p ,color as s where s.id = $celda[color]";		$rbcolor = mysql_db_query($dbname, $bcolor, $con);		$celdac = mysql_fetch_array($rbcolor);		print("<td>$celdac[nombre]</td>");		//Stock		print("<td>$celda[stock]</td>");		//PCP		print("<td>$celda[precioc]</td>");		//PVP		print("<td>$celda[preciov]</td>");		print("</tr>");		}	print("</table>");}//Orden de visualizaicon Referencia, Referencia Proveedor, Proveedor, año, temporada//Familia, Descripcion, Talla, Color, Stock, PCP, PVP}?>